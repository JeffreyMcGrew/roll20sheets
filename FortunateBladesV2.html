<main>
    <section class="header">
      <h1>Fortunate Blades</h1>
      <div class="header-grid">
        <div>
        <label><span class="label_text">Name: </span><input name="attr_character_name" type="text"></label>
        <label><span class="label_text">Look: </span><input name="attr_character_look" type="text"></label>
        </div>
        <div>
        <label><span class="label_text">Backgrounds: </span><input name="attr_character_backgrounds" type="text"></label>
        <label><span class="label_text">Trades: </span><input name="attr_character_trades" type="text"></label>
        </div>
      </div>
      <div>
        <label><span class="attr_text">XP: </span><input name="attr_character_xp" type="text"></label>
        <label><span class="attr_text">Level </span><input name="attr_character_level" type="number" value="1"></label>
      </div>
    </section>
  
    <section class="attributes">
      <h2>Attributes</h2>
      <span class="attributes-grid">
        <div class="physical-stats">
          <h3>Physical</h3>
            <div class="f-row nowrap">
              <label><span class="attr_text">Fight</span></label>
              <input type="number" name="attr_fight" value="0">
              <button type="roll" name="roll_fight" value="&{template:rolls} {{title=Fight}} {{subtitle=@{character_name} }} {{roll= [[d20+@{fight}[fight] ]]}}"> </button>
            </div>
            <div class="f-row nowrap">
              <label><span class="attr_text">Finesse</span></label>
              <input type="number" name="attr_finesse" value="0">
              <button type="roll" name="roll_finesse" value="&{template:rolls} {{title=Finesse}} {{subtitle=@{character_name} }} {{roll= [[d20+@{finesse}[finesse] ]]}}"> </button>
            </div>
            <div class="f-row nowrap">
              <label><span class="attr_text">Wreck</span></label>
              <input type="number" name="attr_wreak" value="0">
              <button type="roll" name="roll_wreak" value="&{template:rolls} {{title=Wreak}} {{subtitle=@{character_name} }} {{roll= [[d20+@{wreak}[wreak] ]]}}"> </button>
            </div>
            <div class="f-row nowrap">
              <label><span class="attr_text">Sneak</span></label>
              <input type="number" name="attr_sneak" value="0">
              <button type="roll" name="roll_sneak" value="&{template:rolls} {{title=Sneak}} {{subtitle=@{character_name} }} {{roll= [[d20+@{sneak}[sneak] ]]}}"> </button>
            </div>
            <hr>
            <div class="f-row nowrap">
                <label><span class="attr_text">Physical Armor</span></label>
                <input type="number" name="attr_physicalarmor" value="0">
                <button type="roll" name="roll_physicalsave" value="&{template:rolls} {{title=Physical Save}} {{subtitle=@{character_name} }} {{roll= [[d20+@{physicalarmor}[physicalsave] ]]}}"> </button>
            </div>
          </div>
          <div class="mental-stats"> 
            <h3>Mental</h3>
            <div class="f-row nowrap">
              <label><span class="attr_text">Notice</span></label>
              <input type="number" name="attr_notice" value="0">
              <button type="roll" name="roll_notice" value="&{template:rolls} {{title=Notice}} {{subtitle=@{character_name} }} {{roll= [[d20+@{notice}[notice] ]]}}"> </button>
            </div>
            <div class="f-row nowrap">
              <label><span class="attr_text">Study</span></label>
              <input type="number" name="attr_study" value="0">
              <button type="roll" name="roll_study" value="&{template:rolls} {{title=Study}} {{subtitle=@{character_name} }} {{roll= [[d20+@{study}[study] ]]}}"> </button>
            </div>
            <div class="f-row nowrap">
              <label><span class="attr_text">Craft</span></label>
              <input type="number" name="attr_craft" value="0">
              <button type="roll" name="roll_craft" value="&{template:rolls} {{title=Craft}} {{subtitle=@{character_name} }} {{roll= [[d20+@{craft}[craft] ]]}}"> </button>
            </div>
            <div class="f-row nowrap">
              <label><span class="attr_text">Lore</span></label>
              <input type="number" name="attr_lore" value="0">
              <button type="roll" name="roll_lore" value="&{template:rolls} {{title=Lore}} {{subtitle=@{character_name} }} {{roll= [[d20+@{lore}[lore] ]]}}"> </button>
            </div>
            <hr>
            <div class="f-row nowrap">
              <label><span class="attr_text">Mental Save</span></label>
              <input type="number" name="attr_mentalsave" value="0">
              <button type="roll" name="roll_mentalsave" value="&{template:rolls} {{title=Mental Save}} {{subtitle=@{character_name} }} {{roll= [[d20+@{mentalsave}[mentalsave] ]]}}"> </button>
            </div>
            <div>
              <span class="attr_text">Mental XP</span>
              <span class="xp-bar">
                <input type="radio" value="0" name="attr_mental_xp" checked>
                <input type="radio" value="1" name="attr_mental_xp" >
                <input type="radio" value="2" name="attr_mental_xp" >
                <input type="radio" value="3" name="attr_mental_xp" >
                <input type="radio" value="4" name="attr_mental_xp" >
                <input type="radio" value="5" name="attr_mental_xp" >
                <input type="radio" value="6" name="attr_mental_xp" >
                <input type="radio" value="7" name="attr_mental_xp" >
                <input type="radio" value="8" name="attr_mental_xp" >
              </span>
            </div>
          </div>
          <div class="Spiritual-stats">
            <h3>Spiritual</h3>
            <div class="f-row nowrap">
              <label><span class="attr_text">Attune</span></label>
              <input type="number" name="attr_attune" value="0">
              <button type="roll" name="roll_attune" value="&{template:rolls} {{title=Attune}} {{subtitle=@{character_name} }} {{roll= [[d20+@{attune}[attune] ]]}}"> </button>
            </div>
            <div class="f-row nowrap">
              <label><span class="attr_text">Endure</span></label>
              <input type="number" name="attr_endure" value="0">
              <button type="roll" name="roll_endure" value="&{template:rolls} {{title=Endure}} {{subtitle=@{character_name} }} {{roll= [[d20+@{endure}[endure] ]]}}"> </button>
            </div>
            <div class="f-row nowrap">
              <label><span class="attr_text">Convince</span></label>
              <input type="number" name="attr_convince" value="0">
              <button type="roll" name="roll_convince" value="&{template:rolls} {{title=Convince}} {{subtitle=@{character_name} }} {{roll= [[d20+@{convince}[convince] ]]}}"> </button>
            </div>
            <div class="f-row nowrap">
              <label><span class="attr_text">Carouse</span></label>
              <input type="number" name="attr_carouse" value="0">
              <button type="roll" name="roll_carouse" value="&{template:rolls} {{title=Carouse}} {{subtitle=@{character_name} }} {{roll= [[d20+@{carouse}[carouse] ]]}}"> </button>
            </div>
            <hr>
            <div class="f-row nowrap">
              <label><span class="attr_text">Spiritual Save</span></label>
              <input type="number" name="attr_spiritsave" value="0">
              <button type="roll" name="roll_spiritsave" value="&{template:rolls} {{title=Spiritual Save}} {{subtitle=@{character_name} }} {{roll= [[d20+@{spiritsave}[spiritsave] ]]}}"> </button>
            </div>
            <div>
              <span class="attr_text">Spiritual XP</span>
              <span class="xp-bar">
                <input type="radio" value="0" name="attr_spirit_xp" checked>
                <input type="radio" value="1" name="attr_spirit_xp" >
                <input type="radio" value="2" name="attr_spirit_xp" >
                <input type="radio" value="3" name="attr_spirit_xp" >
                <input type="radio" value="4" name="attr_spirit_xp" >
                <input type="radio" value="5" name="attr_spirit_xp" >
                <input type="radio" value="6" name="attr_spirit_xp" >
                <input type="radio" value="7" name="attr_spirit_xp" >
                <input type="radio" value="8" name="attr_spirit_xp" >
              </span>
            </div>
          </div>
        </span>  
    </section>
  
    <section class="common">
      <div class="fortune-bar">
        <h3>Fortune</h3>
        <div class="sheet-container">
          <span class="attr_text">Max:</span><input type='number' name='attr_formax' value='8'>
          <span class="attr_text">    Spent:</span><input type='number' name='attr_forcur' value='0'>
          <input type='hidden' type='number' value='@{foricv}' name="attr_forbar" class="sheet-hidden sheet-forbar" disabled='true'>
          <div class="sheet-forbar"></div>
      </div>
  
      <p></p>
        
        <h4>Marks</h4>
        <fieldset class="repeating_marks">
            <textarea name="attr_marks" type="text"></textarea>
        </fieldset>
      </div>
  
      <div class="harm">
      <h3>Harm</h3>
        <div class="harm-table">
          <div class="harm-table-heroic"><h4>Heroic Harm - No Actions without spending Fortune</h4><span class="harm-entry"><input name="attr_character_harm_heroic" type="text"></input></span></div>
          <div class="harm-table-area"><h4>Serious Harm - Unlucky</h4><input name="attr_character_harm_serious1" type="text"></input></div>
          <div class="harm-table-area"><h4>Serious Harm - Unlucky</h4><input name="attr_character_harm_serious2" type="text"></input></div>
          <div class="harm-table-area"><h4>Simple Harm - Less Effect</h4><input name="attr_character_harm_simple1" type="text"></input></div>
          <div class="harm-table-area"><h4>Simple Harm - Less Effect</h4><input name="attr_character_harm_simple2" type="text"></input></div>
        </div>
      </div>
    </section>
  
    <section class="talents">
      <h2>Talents</h2>
      <div class="xp-bar">Talent XP
        <input type="radio" value="0" name="attr_talent_xp" checked>
        <input type="radio" value="1" name="attr_talent_xp" >
        <input type="radio" value="2" name="attr_talent_xp" >
        <input type="radio" value="3" name="attr_talent_xp" >
        <input type="radio" value="4" name="attr_talent_xp" >
        <input type="radio" value="5" name="attr_talent_xp" >
        <input type="radio" value="6" name="attr_talent_xp" >
        <input type="radio" value="7" name="attr_talent_xp" >
        <input type="radio" value="8" name="attr_talent_xp" >
        <input type="radio" value="9" name="attr_talent_xp" >
      </div>
      <p> </p>
      <fieldset class="repeating_talent">
          <textarea name="attr_ability" type="text"></textarea>
      </fieldset>
    </section>
  
    <section class="inv">
      <h3>Gear</h3>
      <fieldset class="repeating_gear">
        <div class="gear-line">
          <div class="gear-disc"><input name="attr_inventory" type="text"></input></div>
          <div class="gear-load">Load <input type="number" name="attr_load" value="0"></input></div>
        </div>
      </fieldset>
    </section>
  
    <section class="misc">
      <h3>Notes</h3>
      <textarea name="attr_description"></textarea>
    </section>
    
    <script type="text/worker">
      on("sheet:opened change:forcur change:formax", function() {
         getAttrs(["forcur", "formax"], function(values) {
          var maximum = values.formax;
          var current = values.forcur;
          var forPercent = [0,10,20,30,40,50,60,70,80,90,100,999];
          for(let i = 0; i < forPercent.length; i++) {
          if(current <= (maximum * forPercent[i]/ 100)){ 
          tvalue = i;
          console.log("Toxic value is " + tvalue)
          break; 
          }
          }
                  setAttrs({
                  "foricv":tvalue
              });
        });
      });
      </script>
  
  </main>
  
  <!-- Datalists & thing that don't show directly on sheet -->
  
  <!-- roll template -->
  
  <rolltemplate class="sheet-rolltemplate-rolls">
    <div class="sheet-container">
      <div class="sheet-header">
        {{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
        {{#name}}<div class="sheet-name">{{name}}</div>{{/name}}
        {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
      </div>
      <div class="sheet-content">
        {{#allprops() title name subtitle desc}}
        <div class="sheet-key">{{key}}</div>
        <div class="sheet-value">{{value}}</div>
        {{/allprops() title name subtitle desc}}
        {{#desc}}<div class="sheet-desc">{{desc}}</div>{{/desc}}
      </div>
    </div>
  </rolltemplate>
  